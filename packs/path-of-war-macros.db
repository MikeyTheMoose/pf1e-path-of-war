{"_id":"NSjQC77TnhCKxgkd","name":"PoW - Recover All Maneuvers","type":"script","author":"pGtrBsyWNme2G1e0","img":"icons/commodities/currency/coin-inset-lightning-silver.webp","scope":"global","command":"if (actor) {\n  const actorData = actor.data.data;\n  const itemUpdates = [];\n  const updateData = {};\n  const spellbookUses = {};\n  const bookName = \"Primary\" // Change to \"Secondary\" or \"Tertiary\" if needed\n\n      for (const item of actor.items) {\n        const itemUpdate = { _id: item.id };\n        const itemData = item.data.data;\n\n        if (item.type === \"spell\") {\n          const spellbook = getProperty(actorData, `attributes.spells.spellbooks.${itemData.spellbook}`),\n            isSpontaneous = spellbook.spontaneous;\n          if (!isSpontaneous && spellbook.name === `${bookName}`) {\n            if (itemData.preparation.preparedAmount < itemData.preparation.maxAmount) {\n              itemUpdate[\"data.preparation.preparedAmount\"] = itemData.preparation.maxAmount;\n              itemUpdates.push(itemUpdate);\n            }\n            if (!getProperty(item.data, \"data.domain\")) {\n              let sbUses =\n                updateData[\n                  `data.attributes.spells.spellbooks.${itemData.spellbook}.spells.spell${itemData.level}.value`\n                ] || 0;\n              sbUses -= itemData.preparation.maxAmount;\n              updateData[\n                `data.attributes.spells.spellbooks.${itemData.spellbook}.spells.spell${itemData.level}.value`\n              ] = sbUses;\n            }\n          }\n        }\n      }\n      actor.updateEmbeddedDocuments(\"Item\", itemUpdates);\n      actor.update(updateData);\n      ChatMessage.create({\n          flavor: \"Path of War Manevuers\",\n          content: \"All maneuvers recovered.\",\n          speaker: ChatMessage.getSpeaker(),\n      })\n} else ui.notifications.warn(\"No actor selected\");","folder":null,"sort":0,"permission":{"default":0,"pGtrBsyWNme2G1e0":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#00f7ff","trigger":""}},"core":{"sourceId":"Macro.8naqz2aXy8qpDLPK"}}}
{"_id":"WgiyuLtaE217CuMs","name":"PoW - Prepare Stances","type":"script","author":"pGtrBsyWNme2G1e0","img":"icons/commodities/currency/coin-inset-copper-axe.webp","scope":"global","command":"new SCUPrepareSpells(null, {spellbook: 'primary'}).render(true)","folder":null,"sort":0,"permission":{"default":0,"pGtrBsyWNme2G1e0":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#00f7ff","trigger":""}},"core":{"sourceId":"Macro.2N2GXEQjiTLVmiVk"}}}
{"_id":"gbrZ1n3qD7GfTT3L","name":"PoW - Change Stance","type":"script","author":"pGtrBsyWNme2G1e0","img":"icons/commodities/currency/coin-inset-swirl-gold.webp","scope":"global","command":"// Using this requires that your stances are Buffs on the character sheet. It searches for all buffs with \"Stance\" in the name, then allows you to switch between them, toggling your choice on and any others off.\n// TO-DO: Create a compendium with stance buffs.\n\n\n(async () => {\nvar actor = token?.actor ?? character ?? actor,\n    [active, deactive] = token.actor.items.filter(o => o.type == \"buff\" && o.name.indexOf(\"Stance\") > -1).partition(p => !p.data.data.active),\n    updates = active.map(p => { return {_id: p.id, \"data.active\": false}; });\nDialog.prompt({\n    title: \"Choose style\",\n    content: `<h1>${active[0].name}</h1><select style=\"width: 100%\">${deactive.map(o => `<option value=\"${o.id}\">${o.name}</option>`).join(\"\")}</select>`,\n    label: \"Activate\",\n    callback: (htm) => {\n        updates.push({_id: htm[0].querySelector(\"select\").value, \"data.active\": true});\n        actor.updateEmbeddedDocuments(\"Item\", updates);\n    },\n});\n})()","folder":null,"sort":0,"permission":{"default":0,"pGtrBsyWNme2G1e0":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#00f7ff","trigger":""}},"core":{"sourceId":"Macro.BhBrdysxb2e5sMlB"}}}
